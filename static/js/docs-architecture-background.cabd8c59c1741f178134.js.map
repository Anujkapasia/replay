{"version":3,"sources":["webpack:///./src/replay/docs/architecture/background.mdx"],"names":["MDXContent","props","_this","_classCallCheck","this","_possibleConstructorReturn","_getPrototypeOf","call","layout","React","Component","_this$props","components","_objectWithoutProperties","react__WEBPACK_IMPORTED_MODULE_0___default","a","createElement","_mdx_js_tag__WEBPACK_IMPORTED_MODULE_1__","name","id","parentName","href"],"mappings":"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","file":"static/js/docs-architecture-background.40ae2462.js","sourcesContent":["\n  import React from 'react'\n  import { MDXTag } from '@mdx-js/tag'\n  \n\nconst layoutProps = {\n  \n};\nexport default class MDXContent extends React.Component {\n  constructor(props) {\n    super(props)\n    this.layout = null\n  }\n  render() {\n    const { components, ...props } = this.props\n\n    return <MDXTag\n             name=\"wrapper\"\n             \n             components={components}><MDXTag name=\"h1\" components={components} props={{\"id\":\"background-the-challenges-and-requirements\"}}>{`Background: The challenges and requirements`}</MDXTag>\n<MDXTag name=\"h2\" components={components} props={{\"id\":\"defining-the-video-player\"}}>{`Defining the video player`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`The task of playing back video in a web page, is more or less handled by the browser through the HTML `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`<video>`}</MDXTag>{` element. However, requiring a custom player UI or sophisticated playback technologies, adding a video player to the page becomes a development concern, and we can't or won't just deal with the browser abstractions.`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`In the scope of this project, and quite commonly in frontend development, a (customised) video player in a web page is defined by a set of page elements: The element displaying/rendering the video stream (and all the inner mechanics behind this task), combined with element hierarchy constituting the player user interface, with controls, overlays, styling, and a layout. This becomes a branch of the page DOM tree looking a bit like its own ecosystem. Often, the video player should operate quite autonomously after being instantiated and told what to play.`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`The video player could be enriched with extra features for the end-user or behind-the-scenes, and it could be desired to keep these extensions as part of the subtree-scoped player ecosystem. Examples are REST API consumption, content recommendation overlays or menus, game events related to a sports live stream, video ad system integrations, or tracking/analytics integrations.`}</MDXTag>\n<MDXTag name=\"h2\" components={components} props={{\"id\":\"goals-of-this-player-project\"}}>{`Goals of this player project`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`This project is built with customisation and extensibility in mind for these purposes, however at this time it only implements features covering the core playback tasks along with a core playback UX. It also prepares to allow for advanced, multiple playback/streaming technologies with a consistent wrapping of, and plug-in approach to, existing implementations/libraries. The same wrapping might also be used to plug in embed playback from e.g. YouTube or Vimeo in the same consistent wrapping, but the roots of this project are professional streaming requirements from independent services.`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`Part of reaching these goal is extensively adopting modern React patterns giving structure, clarity, and predictability to the running player code. Core video playback in the browser unfortunately gives a lot of surprises and inconsistencies to a player developer (example: `}<MDXTag name=\"em\" components={components} parentName=\"p\">{`Why is the HTML video element state in some browsers \"paused\" when seeking to a different position?`}</MDXTag>{`). One goal is to express the observed playback state to observers, like player controls, in a clean manner. This is different to several other React video player alternatives out there.`}</MDXTag>\n<MDXTag name=\"h2\" components={components} props={{\"id\":\"the-task-of-the-video-player-ui-consuming-and-controlling-the-video-playback-state\"}}>{`The task of the video player UI: Consuming and controlling the video playback state`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`A video being played has a state with a lot of properties. Throughout playback, the state is set or changes because of 1) events coming from the stream and stream delivery itself, 2) the nature/lifecycle of video playback, and 3) as a result of outer manipulation of the playback state, from e.g. end users or external integrations.`}</MDXTag>\n<MDXTag name=\"h4\" components={components} props={{\"id\":\"examples-of-1\"}}>{`Examples of 1):`}</MDXTag>\n<MDXTag name=\"ul\" components={components}>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`The bitrate changes adaptively because of varying network conditions. `}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`The stream appears to have several audio tracks.`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`A live stream increases its DVR window length.`}</MDXTag>\n</MDXTag>\n<MDXTag name=\"h4\" components={components} props={{\"id\":\"examples-of-2\"}}>{`Examples of 2):`}</MDXTag>\n<MDXTag name=\"ul\" components={components}>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`Video starts or ends.`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`Playback position changes.`}</MDXTag>\n</MDXTag>\n<MDXTag name=\"h4\" components={components} props={{\"id\":\"example-of-3-operations-leading-to-state-changes\"}}>{`Example of 3), operations leading to state changes:`}</MDXTag>\n<MDXTag name=\"ul\" components={components}>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`The user selects a subtitles track to be displayed.`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`The user changes the playback position (seeks) through the timeline control`}</MDXTag>\n<MDXTag name=\"li\" components={components} parentName=\"ul\">{`A site-wide volume setting mutes the audio of the playback`}</MDXTag>\n</MDXTag>\n<MDXTag name=\"h2\" components={components} props={{\"id\":\"the-multi-faceted-and-complex-task-of-rendering-and-playing-a-video-stream\"}}>{`The multi-faceted and complex task of rendering and playing a video stream`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`When inserting a `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`<video>`}</MDXTag>{` element to a web page, today's browsers with some exceptions are only capable of playing a video file provided from a URL specified in the `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`src`}</MDXTag>{` attribute. The browsers don't handle the following concerns: Adaptive streaming achieving continuous playback adapting to varying bandwidth conditions. Live streaming with or without timeshifting, DRM (a concern only for premium content providers), multiple audio tracks, multiple subtitles formats.`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`For fulfilling these requirements, there are advanced streaming technologies, and for the browser, there are Javascript libraries that make the browser capable of playing streams with the advanced features. Examples are HLS.js, Dash.js, and Shaka Player.`}</MDXTag>\n<MDXTag name=\"h1\" components={components} props={{\"id\":\"the-main-pattern-and-principles-for-replay\"}}>{`The main pattern and principles for Replay`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`A Replay player contains components with three main roles: 1) Player UI components (controls and player containment), 2) a video streamer component rendering/playing the video, abstracting technological or platform concerns, and 3) a player controller hub component connecting the video streamer with the player UI, plus managing it all.`}</MDXTag>\n<MDXTag name=\"h2\" components={components} props={{\"id\":\"consistently-exposing-and-dealing-with-the-state\"}}>{`Consistently exposing and dealing with the state`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`The core principle of Replay is distilling the different state properties related to the video playback, and expose it to the full player UI element tree. At the same time, all controls and components can invoke actions manipulating some of the properties of playback. All this with as little boilerplate code, like `}<MDXTag name=\"inlineCode\" components={components} parentName=\"p\">{`ref`}</MDXTag>{`-plumbing or `}<MDXTag name=\"a\" components={components} parentName=\"p\" props={{\"href\":\"https://blog.kentcdodds.com/prop-drilling-bb62e02cb691\"}}>{`prop-drilling`}</MDXTag>{`, as possible.`}</MDXTag>\n<MDXTag name=\"h2\" components={components} props={{\"id\":\"discarded-implementation-alternatives\"}}>{`Discarded implementation alternatives`}</MDXTag>\n<MDXTag name=\"h3\" components={components} props={{\"id\":\"the-familiar-react-pattern\"}}>{`The familiar React pattern`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`Passing down state across components, and invoking actions manipulating the state, is a well-known and central React pattern, and often implemented with Redux. Could playback state like play/pause mode, duration, available subtitle tracks, etc. be transferred and exposed in a Redux state slice? Could manipulating the player be Flux actions, setting volume, seeking, toggling pause?`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`Certainly, but it is not a good fit: A video player is most often only an autonomous component in a page or single-page-app, and the Redux state contains a lot of unrelated information most often concerning the full app state and data presented to the user or supplied by the user. This is similar to e.g. a complex form component like a combo-box. The expanded/collapsed state and filtering dropdown items based on entered characters, are examples of data that are not wise to manage in Redux and with Flux actions.`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`Further, Redux state works best with \"singletons\" in a page. Contrary, quite common use-cases for a video player component could imply inserting more than instance in a page, and the state should not be mixed between them.`}</MDXTag>\n<MDXTag name=\"h3\" components={components} props={{\"id\":\"just-passing-props-and-callbacks\"}}>{`Just passing props and callbacks?`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`For simple/flat player UI trees this could be useful. Still the state and playback API needs to be \"lifted up\" from the video streamer component so it can be exposed downwards to player UI components, and significant amounts of \"plumbing\" is needed. Besides, it is hard to design this with optimal performance in mind. Every time the playback position is updated, the prop set is changed, and from the top of the player UI tree, a rerender will be required down to the components actually consuming the playback position. This does have a performance impact.`}</MDXTag>\n<MDXTag name=\"h2\" components={components} props={{\"id\":\"the-player-controller-and-its-nice-react-fit\"}}>{`The player controller and its nice React fit`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`The Context API, introduced with React 16.3, is on the other hand a good fit. It makes it easy to share and scope state in a branch/part of the rendered React element tree. Any player instance will keep data private between instances, other parts of the React app don't need to deal with playback state (unless it is desired). The player becomes an isolated component abstracting its inner concerns.`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`Any components within the player subtree dependent on playback state and/or controlling the playback can consume a React player context. The hub component providing the context is the player controller. As the video rendering component is also located somewhere deep down in the player UI component tree, the player controller also uses the context to pass down the video streamer element to its desired UI tree location.`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`Further, using the context means not passing down playback state props through the player UI render tree to components consuming them. This eliminates the full subtree rerender requirement. Each component individually can subscribe to specific props and only get updated when those props update.`}</MDXTag>\n<MDXTag name=\"p\" components={components}>{`The player controller hosts the player UI and the video streamer, and also manages configuration.`}</MDXTag>\n           </MDXTag>\n  }\n}\n  "],"sourceRoot":""}