(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{"./src/replay/components/player/VideoStreamer/HlsjsVideoStreamer/HlsjsVideoStreamer.js":function(e,t,r){"use strict";r.r(t);var n=r("./src/replay/components/player/VideoStreamer/common/createVideoStreamerComponent.js"),a=r("./node_modules/hls.js/dist/hls.js"),i=r.n(a),o=r("./src/replay/components/player/VideoStreamer/types.js");function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=e.hls;r&&e.subscribers.forEach(function(e){return e(r,t)})}function u(e,t){return new Promise(function(r,n){if(i.a.isSupported()){var a=t&&t.hlsjs&&t.hlsjs.customConfiguration,s=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){l(e,t,r[t])})}return e}({autoStartLoad:!1,debug:t&&"DEBUG"===t.logLevel},a),u=new i.a(s);u.on(i.a.Events.MEDIA_ATTACHED,function(){r(u)}),u.attachMedia(e)}else n(new o.a("STREAM_ERROR_TECHNOLOGY_UNSUPPORTED","hlsjs","Hls.js is not supported in this browser."))})}function c(e){var t=e.hls;return t?(t.stopLoad(),s(e,"off"),Promise.resolve(t.destroy())):Promise.resolve()}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(s){a=!0,i=s}finally{try{n||null==l.return||l.return()}finally{if(a)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d=new Date(0),p=100;var E=function(e,t,r){var n,a,o,l=r&&r.liveEdgeMargin||10,s=0,u=!1;function c(){a=null,s=0,u=!1}var E=(v(n={},i.a.Events.MANIFEST_LOADING,function(){return c}),v(n,i.a.Events.LEVEL_LOADED,function(e,t){u=t.details.live,s=t.details.totalduration;var r=t.details&&t.details.fragments&&t.details.fragments[0]&&t.details.fragments[0].programDateTime;r&&(a=new Date(r))}),n);return t.subscribers.push(function(e,t){Object.entries(E).forEach(function(r){var n=f(r,2),a=n[0],i=n[1];e[t](a,i),"on"===t&&(o=e)})}),{adjustForDvrStartOffset:function(){},calculateNewState:function(){var t;t=s?Math.max((e.currentTime||0)-Math.max(e.duration-s,0),0):e.currentTime||0;var r=s||e.duration,n=function(e,t,r){if(e){if(t instanceof Date&&!isNaN(t))return{absolutePosition:new Date(t.getTime()+1e3*r),absoluteStartPosition:t};var n=new Date,a=new Date(n.getTime()-1e3*r);return{absolutePosition:n,absoluteStartPosition:a}}return{absolutePosition:d,absoluteStartPosition:d}}(u,a,t),i=n.absolutePosition,c=n.absoluteStartPosition;return{position:t,duration:r,playMode:function(e,t){return t?e===1/0||0===e||e<p?"live":"livedvr":"ondemand"}(r,u),isAtLiveEdge:o&&function(e,t,r,n){return!!r&&(e.liveSyncPosition?t.currentTime>e.liveSyncPosition-n:e.config&&e.config.liveSyncDuration?t.currentTime>t.duration-(e.config.liveSyncDuration+n):!(!e.config||!e.config.liveSyncDurationCount)&&t.currentTime>t.duration-(10*e.config.liveSyncDurationCount+n))}(o,e,u,l),absolutePosition:i,absoluteStartPosition:c}},setPosition:function(t){isNaN(t)||t===1/0||isNaN(e.duration)||e.duration===1/0||(e.currentTime=s?t+e.duration-s:t)},gotoLive:function(){u&&o&&(o.liveSyncPosition?e.currentTime=o.liveSyncPosition:o.config&&o.config.liveSyncDuration?e.currentTime=e.duration-(o.config.liveSyncDuration+l):o.config&&o.config.liveSyncDurationCount?e.currentTime=e.duration-(10*o.config.liveSyncDurationCount+l):e.currentTime=e.duration-l)}}},g=r("./src/replay/components/player/VideoStreamer/common/sourceNormalizer.js"),b=function(e){return function(t,r){var n=e.videoElement;c(e);var a=Object(g.a)(t.source);return a?u(n,t.configuration).then(function(t){return e.hls=t,s(e,"on"),new Promise(function(e,r){try{t.stopLoad(),t.on(i.a.Events.MANIFEST_PARSED,function n(){t.off(i.a.Events.MANIFEST_PARSED,n);try{a.startPosition?t.startLoad(a.startPosition):t.startLoad(),e()}catch(l){r(new o.a("STREAM_ERROR","hlsjs","Stream load start failed.","FATAL",l))}}),t.loadSource(a.streamUrl)}catch(n){r(new o.a("STREAM_ERROR","hlsjs","Stream load failed.","FATAL",n))}})}):Promise.resolve()}},m=r("./src/replay/components/player/VideoStreamer/common/filteredStreamStateUpdater.js"),y=r("./src/replay/components/player/VideoStreamer/common/propertyApplier.js"),S=r("./src/replay/components/player/VideoStreamer/common/playbackLifeCycleManager.js"),R=r("./src/replay/components/player/VideoStreamer/common/renderers.js"),A=r("./src/replay/components/player/VideoStreamer/common/logger.js");function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(s){a=!0,i=s}finally{try{n||null==l.return||l.return()}finally{if(a)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var T=function(e){var t=[];return e?e.filter(function(e){var r="".concat(e.lang||"","!").concat(e.name||""),n=t.indexOf(r)<0;return n&&t.push(r),n}).map(function(e){return{id:e.id,language:e.lang||"unknown",kind:"",label:e.name||"unknown",origin:"in-stream"}}):[]},P=function(e,t){return!e&&!t||e===t},D=function(e,t){return!e||!t||e===t},_=function(e,t){if(e.length===t.length){for(var r=0;r<e.length;r++)if(!P(e[r].id,t[r].id)||!P(e[r].language,t[r].language)||!P(e[r].label,t[r].label))return!0;return!1}return!0},L=function(e,t){var r,n,a=[];function o(){if(n){var e=T(n.audioTracks);_(e,a)&&(a=e)}}function l(){var e=null;if(n){var r=n.audioTracks.filter(function(e){return e.id===n.audioTrack})[0];if(r){var i=r.name,o=r.lang;e=a.filter(function(e){var t=e.label,r=e.language;return t===i&&r===o})[0]}}t({audioTracks:a,currentAudioTrack:e})}function s(){o(),l()}function u(){a=[]}var c=(O(r={},i.a.Events.MANIFEST_LOADING,function(){return u}),O(r,i.a.Events.MANIFEST_PARSED,s),O(r,i.a.Events.AUDIO_TRACK_SWITCHED,function(){o(),l()}),r);return e.subscribers.push(function(e,t){Object.entries(c).forEach(function(r){var a=h(r,2),i=a[0],o=a[1];e[t](i,o),"on"===t&&(n=e)})}),{cleanup:function(){},handleSourceChange:function(){s()},handleSelectedAudioTrackChange:function(e){var t=e;if(n&&n.audioTracks&&t){var r=(n.audioTracks[n.audioTrack]||{}).groupId,a=n.audioTracks.filter(function(e){return D(e.groupId,r)&&D(e.name,t.label)&&D(e.lang,t.language)})[0];a&&(n.audioTrack=a.id)}}}},w=r("./src/replay/components/player/VideoStreamer/BasicVideoStreamer/textTrackManager.js"),j=r("./src/replay/components/common.js");function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(s){a=!0,i=s}finally{try{n||null==l.return||l.return()}finally{if(a)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function N(e){return e&&Math.ceil(e.bitrate/1e3)||0}var k=function(e,t,r,n){var a,o,l=[];function s(e,t){if(o){var a=Array.isArray(o.levels)?o.levels.map(N):[];Object(j.i)(l,a)&&(a=l);var s=e===i.a.Events.LEVEL_SWITCHED?t.level:-1===o.currentLevel?o.startLevel:o.currentLevel;if(-1===s)n&&n("No hls.js level reported currently or selected for start."),r({bitrates:a});else{var u=N(o.levels[s]);r({currentBitrate:u,bitrates:a})}}}var u=(C(a={},i.a.Events.MANIFEST_LOADING,function(){l=[]}),C(a,i.a.Events.MANIFEST_PARSED,s),C(a,i.a.Events.LEVEL_SWITCHED,s),C(a,i.a.Events.LEVEL_UPDATED,s),a);return t.subscribers.push(function(e,t){Object.entries(u).forEach(function(r){var n=F(r,2),a=n[0],i=n[1];e[t](a,i),"on"===t&&(o=e)})}),{fixBitrate:function(e){if(o)if("min"===e)Array.isArray(o.levels)&&o.levels.length>0&&(o.nextLevel=0,r({bitrateFix:N(o.levels[0])}),n&&n("Fixing bitrate to lowest level out of "+o.levels.length));else if("max"===e)Array.isArray(o.levels)&&o.levels.length>0&&(o.nextLevel=o.levels.length-1,r({bitrateFix:N(o.levels[o.levels.length-1])}),n&&n("Fixing bitrate to highest level out of "+o.levels.length));else if(null==e||isNaN(e)||e<0||!e)n&&n("Resetting fixing of bitrate."),o.nextLevel=-1,r({bitrateFix:null});else if("string"===typeof e)n&&n("Unknown string specified for bitrate lock. Please use a value of type number if a bitrate specified by kbps is intended.",e);else if(Array.isArray(o.levels)){for(var t=0;t<o.levels.length;t++)if(N(o.levels[t])===e)return o.nextLevel=t,n&&n("Fixing bitrate to HLS level "+t,o.levels),void r({bitrateFix:e});n&&n("Desired bitrate lock didn't match any bitrates specified in the hls.levels list. Not applied.",o.levels)}else n&&n("Found no HLS levels from where bitrate fixing can be applied.",o.levels)},capBitrate:function(e){if(o)if(isNaN(e)||e===1/0||null==e||e<0)n&&n("Resetting restrictions for bitrate."),o.autoLevelCapping=-1,r({bitrateCap:null});else if(Array.isArray(o.levels)){for(var t=!1,a=0;a<o.levels.length;a++){var i=N(o.levels[a]);if(i===e){o.autoLevelCapping=a,r({bitrateCap:N(o.levels[a])}),n&&n("Desired bitrate cap "+e+" is equal to level on index "+a+" in hls.js.",o.levels),t=!0;break}if(i>e){a>0?(o.autoLevelCapping=a-1,r({bitrateCap:N(o.levels[a-1])}),n&&n("Desired bitrate cap "+e+" is closest to level on index "+(a-1)+" in hls.js.",o.levels)):(o.autoLevelCapping=0,n&&n("Desired bitrate cap "+e+" appears to be lower than the lowest HLS level. Aligning to lowest level.",o.levels),r({bitrateCap:N(o.levels[0])})),t=!0;break}}t||n&&n("Desired bitrate cap appears to be higher than the higher HLS level. Not applicable.",o.levels)}else n&&n("Found no HLS levels from where bitrate capping can be applied.",o.levels)}}},M=r("./src/replay/components/player/VideoStreamer/BasicVideoStreamer/basicVideoEventHandlers.js"),I="hlsjs",x=i.a.ErrorDetails,V=[x.MANIFEST_LOAD_ERROR,x.MANIFEST_LOAD_TIMEOUT,x.LEVEL_LOAD_ERROR,x.LEVEL_LOAD_TIMEOUT,x.AUDIO_TRACK_LOAD_ERROR,x.AUDIO_TRACK_LOAD_TIMEOUT,x.FRAG_LOAD_ERROR,x.FRAG_LOOP_LOADING_ERROR,x.FRAG_LOAD_TIMEOUT,x.KEY_LOAD_ERROR,x.KEY_LOAD_TIMEOUT],U=[x.MANIFEST_PARSING_ERROR,x.MANIFEST_INCOMPATIBLE_CODECS_ERROR,x.FRAG_DECRYPT_ERROR,x.BUFFER_ADD_CODEC_ERROR,x.FRAG_PARSING_ERROR];function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(s){a=!0,i=s}finally{try{n||null==l.return||l.return()}finally{if(a)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function G(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var B=function(e){var t,r=e.streamer,n=e.videoElement,a=e.instanceKeeper,l=e.streamRangeHelper,s=e.configuration,u=e.applyProperties,c=e.updateStreamState,f=e.log,v=Object(M.a)({streamer:r,videoElement:n,streamRangeHelper:l,configuration:s,log:f,applyProperties:u,updateStreamState:c}),d=v.videoElementEventHandlers,p=v.pauseStreamRangeUpdater,E={setStage:function(e){},getStage:function(){}};function g(e){f&&f("hlsjs.error");var t,a,i,l=(E.getStage(),a=(t=e).fatal?"FATAL":"WARNING",i=(t&&t.details&&V.indexOf(t.details)>=0?"STREAM_ERROR_DOWNLOAD":U.indexOf(t.details)>=0&&"STREAM_ERROR_DECODE")||"STREAM_ERROR",new o.a(i,I,function(e){var t=(e.type?e.type+"/":"")+(e.details||"");return"string"===typeof e.reason?t+": "+e.reason:t}(t),a,t));r.props.onPlaybackError&&r.props.onPlaybackError(l),n.error&&c({error:n.error}),"FATAL"===l.severity&&(E.setStage("dead"),c({playState:"inactive",isBuffering:!1,isSeeking:!1})),p.stop()}var b=(G(t={},i.a.Events.ERROR,function(e,t){switch(t.details){case i.a.ErrorDetails.BUFFER_STALLED_ERROR:c({isBuffering:!0}),"started"===E.getStage()&&c({playState:"buffering"});break;case i.a.ErrorDetails.BUFFER_SEEK_OVER_HOLE:case i.a.ErrorDetails.BUFFER_NUDGE_ON_STALL:break;case i.a.ErrorDetails.MANIFEST_PARSING_ERROR:t.url&&!t.url.endsWith("undefined")&&g(t);break;default:g(t)}}),G(t,i.a.Events.MANIFEST_LOADING,function(){if(f&&f("hlsjs.loading"),"new"===E.getStage()){if(E.setStage("starting"),r.props.initialPlaybackProps){var e=r.props.initialPlaybackProps,t=e.isMuted,a=e.volume;u({isMuted:t,volume:a})}c({playState:"starting",isBuffering:!0,volume:n.volume,isMuted:n.muted,isPipAvailable:v.isPipAvailable()})}}),G(t,i.a.Events.FRAG_BUFFERED,function(){c({isBuffering:!1})}),G(t,i.a.Events.MANIFEST_PARSED,function(){if(f&&f("hlsjs.parsed"),r.props.initialPlaybackProps){var e=r.props.initialPlaybackProps,t=e.isPaused,a=e.bitrateFix,i=e.bitrateCap;t&&n.pause(),u({bitrateFix:a,bitrateCap:i}),null==a&&c({bitrateFix:null}),null==i&&c({bitrateCap:null})}else c({bitrateFix:null,bitrateCap:null});c(l.calculateNewState())}),t);return a.subscribers.push(function(e,t){Object.entries(b).forEach(function(r){var n=H(r,2),a=n[0],i=n[1];e[t](a,i)})}),{videoElementEventHandlers:{onCanPlay:d.onCanPlay,onPlaying:d.onPlaying,onPause:d.onPause,onSeeking:d.onSeeking,onSeeked:d.onSeeked,onDurationChange:d.onDurationChange,onTimeUpdate:d.onTimeUpdate,onVolumeChange:d.onVolumeChange,onProgress:d.onProgress,onEnded:d.onEnded,onError:d.onError},pauseStreamRangeUpdater:p,setLifeCycleManager:function(e){E=e,v.setLifeCycleManager(e)}}};var K=Object(n.a)("HlsjsVideoStreamer",function(e,t,r,n){var a={videoElement:r,subscribers:[]},i=E(r,a,t),o=b(a),l=Object(m.a)(e),s=Object(w.a)(r,l,n),u=L(a,l),f=k(e,a,l,Object(A.a)(window,"bitrateManager").log),v=Object(y.a)(r,i,s,u,f),d=Object(A.a)(window,"videoEvents").log,p=B({streamer:e,videoElement:r,instanceKeeper:a,streamRangeHelper:i,configuration:t,applyProperties:v,updateStreamState:l,log:d}),g=p.videoElementEventHandlers,h=p.setLifeCycleManager,O=Object(S.a)(l,p.pauseStreamRangeUpdater,Object(A.a)(window,"lifecycle").log);h(O);var T=O.startPlaybackSession,P=O.endPlaybackSession,D=a,_=R.a;return Promise.resolve({cleanup:function(){return s.cleanup(),O.cleanup(),c(a)},render:_,textTrackManager:s,audioTrackManager:u,thirdPartyPlayer:D,applyProperties:v,handleSourceChange:o,startPlaybackSession:T,endPlaybackSession:P,videoElementEventHandlers:g})});t.default=K}}]);
//# sourceMappingURL=47.13ccfb395d915e30e453.js.map