(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{"./src/replay/components/player/VideoStreamer/HtmlVideoStreamer/HtmlVideoStreamer.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/replay/components/player/VideoStreamer/common/createVideoStreamerComponent.js"),o=n("./src/replay/components/player/VideoStreamer/BasicVideoStreamer/BasicVideoStreamer.js"),a=n("./src/replay/components/player/VideoStreamer/types.js"),i=n("./src/replay/components/player/VideoStreamer/BasicVideoStreamer/sourceChangeHandler.js"),c=n("./src/replay/components/player/VideoStreamer/common/sourceNormalizer.js");function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(u){o=!0,a=u}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(e){return(s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){var t="function"===typeof Map?new Map:void 0;return(f=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return d(e,arguments,p(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),y(r,e)})(e)}function d(e,t,n){return(d=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&y(o,n.prototype),o}).apply(null,arguments)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",w="html",v=function(e){function t(e,n,r,o){var a,i,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,a=!(c=p(t).call(this,r))||"object"!==s(c)&&"function"!==typeof c?l(i):c,b(l(l(a)),"status",void 0),b(l(l(a)),"url",void 0),b(l(l(a)),"method",void 0),a.status=e,a.url=n,a.method=o,a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,f(Error)),t}();function h(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"GET";return new a.a("STREAM_ERROR_DOWNLOAD",w,n,"FATAL",new v(e.status,t,n,r))}function A(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),r=0,o=e.length;r<o;r++)n[r]=e.charCodeAt(r);return n}function R(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))}function E(e){for(var t,n,r,o,a,i,c,u="",s=0;s<e.length;)o=(t=e[s++])>>2,a=(3&t)<<4|(n=s<e.length?e[s++]:Number.NaN)>>4,i=(15&n)<<2|(r=s<e.length?e[s++]:Number.NaN)>>6,c=63&r,isNaN(n)?i=c=64:isNaN(r)&&(c=64),u+=m.charAt(o)+m.charAt(a)+m.charAt(i)+m.charAt(c);return u}function g(e,t,n,r){"string"===typeof n?n=A(n):"number"===typeof n&&(n=A(""+n));var o=0,a=new ArrayBuffer(t.byteLength+4+n.byteLength+4+r.byteLength),i=new DataView(a);new Uint8Array(a,o,t.byteLength).set(t),o+=t.byteLength,i.setUint32(o,n.byteLength,!0),o+=4;var c=e?new Uint8Array(a,o,n.byteLength):new Uint16Array(a,o,n.length);return c.set(n),o+=c.byteLength,i.setUint32(o,r.byteLength,!0),o+=4,new Uint8Array(a,o,r.byteLength).set(r),new Uint8Array(a,0,a.byteLength)}var L=function(e,t,n,r){if(t&&"WebKitMediaKeys"in window){var o="com.apple.fps.1_0",i=t.contentIdExtractMatch,c=t.fairPlayCertificateUrl,s=t.licenseRequestHeaders&&Object.entries(t.licenseRequestHeaders).map(function(e){var t=u(e,2);return{name:t[0],value:t[1]}})||[],l="binary"===t.requestFormat,f="base64"===t.requestFormat,d=null,y=t.contentId,p=t.licenseUrl;return e.addEventListener("webkitneedkey",b,!1),{cleanup:S}}function b(t){var n=t.initData,u=l?R(n).replace(/^.*:\/\//,""):y||function(e,t){var n=R(e),r=t?"string"===typeof t?new RegExp(t):t:/([0-9]+)$/;if(r.exec){var o=r.exec(n);return o&&o[0]}}(n,i);if(l?r&&r("Content ID extracted from initData.",y):y||r&&r("Content ID extracted from initData.",y),e.webkitKeys||e.webkitSetMediaKeys(new window.WebKitMediaKeys(o)),e.webkitKeys){if(!p){var s=R(n).substring(1);p=s.substring(s.indexOf("/",s.indexOf("://")+3))}if(u)if(d){if(!m(u,g(f,n,u,d)))return void O(new a.a("STREAM_ERROR_DRM_CLIENT_UNAVAILABLE",w,"Could not create key session."))}else{var b=new XMLHttpRequest;b.responseType="arraybuffer",b.addEventListener("load",function(){b.status&&b.status<400?(d=new Uint8Array(b.response),m(u,g(f,n,u,d))&&O(new a.a("STREAM_ERROR_DRM_CLIENT_UNAVAILABLE",w,"Could not create key session."))):O(h(b,c,"Download of FairPlay certificate failed."))}),b.addEventListener("error",function(){return O(h(b,c,"Download of FairPlay certificate was blocked."))},!1),b.addEventListener("timeout",function(){return O(h(b,c,"Download of FairPlay certificate timed out."))},!1),b.open("GET",c,!0),b.send()}else O(new a.a("STREAM_ERROR",w,"No content ID available. Cannot complete FairPlay license acquisition.","FATAL"))}else O(new a.a("STREAM_ERROR_DRM_CLIENT_UNAVAILABLE",w,"Safari EME API not available."))}function m(t,n){var r=e.webkitKeys.createSession("video/mp4",n);if(!r)return!1;r.contentId=t,r.addEventListener("webkitkeymessage",v,!1),r.addEventListener("webkitkeyadded",A,!1),r.addEventListener("webkitkeyerror",L,!1)}function v(e){r&&r("Key session ready for license request.");var t=e.target,n=e.message,o=new XMLHttpRequest;o.responseType=l?"arraybuffer":"text",o.addEventListener("load",function(){if(o.status&&o.status<400)if(l){var e=o.response;t.update(new Uint8Array(e))}else{var n=o.responseText.trim();"<ckc>"===n.substr(0,5)&&"</ckc>"===n.substr(-6)&&(n=n.slice(5,-6)),t.update(function(e){for(var t=window.atob(e),n=t.length,r=new Uint8Array(new ArrayBuffer(n)),o=0;o<n;o++)r[o]=t.charCodeAt(o);return r}(n))}else O(h(o,p,"Acquisition of FairPlay license failed.","POST"))}),o.addEventListener("error",function(){return O(h(o,c,"Acquisition of FairPlay license was blocked."))},!1),o.addEventListener("timeout",function(){return O(h(o,c,"Acquisition of FairPlay license timed out."))},!1),o.open("POST",p,!0),s.forEach(function(e){var t=e.name,n=e.value;o.setRequestHeader(t,n)}),l?(o.setRequestHeader("Content-type","application/octet-stream"),o.send(n)):f?o.send(E(n)):(o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(function(e,t){return t?"contentId="+encodeURIComponent(t.toString())+"spc="+encodeURIComponent(E(e)):"spc="+encodeURIComponent(E(e))}(n,y)))}function A(e){r&&r("Decryption key added",e)}function L(e){var t=e.target&&e.target.error&&e.target.error.code||0;if(6===t||4===t){O(new a.a("STREAM_ERROR_DRM_OUTPUT_BLOCKED",w,"FairPlay blocked the playback because of non-secure output path, e.g. external VGA screen connected.","FATAL",e.target&&e.target.error))}else O(new a.a("STREAM_ERROR_DECODE",w,"Could not decrypt FairPlay stream.","FATAL",e.target&&e.target.error));S()}function S(){e.removeEventListener("webkitneedkey",b,!1)}function O(e){n&&n(e),S()}};var S=function(e){var t,n=Object(i.a)(e);return function(r,o){t&&t.cleanup();var a=function(e,t){var n=Object(c.a)(e);if(n&&n.licenseUrl){var r=n.licenseUrl,o=t&&t.licenseAcquisition&&t.licenseAcquisition.fairPlay||{},a=n.licenseAcquisitionDetails||{},i=a.fairPlayCertificateUrl||o.serviceCertificateUrl,u=a.contentIdExtractMatch||o.contentIdExtractMatch,s=a.fairPlayRequestFormat||o.requestFormat||"formdata",l=a.licenseRequestHeaders,f=a.contentId;return i?{licenseUrl:r,licenseRequestHeaders:l,fairPlayCertificateUrl:i,requestFormat:s,contentId:f,contentIdExtractMatch:u}:null}return null}(r.source,r.configuration);return a&&(t=L(e,a,r.onPlaybackError)),n(r,o)}},O=Object(r.a)("HtmlVideoStreamer",Object(o.getImplementationResolver)(S));t.default=O}}]);
//# sourceMappingURL=49.92d9ba584537a63e6e9f.js.map