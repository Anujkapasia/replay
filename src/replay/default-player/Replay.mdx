---
name: Inserting Replay
route: /replay/insert
menu: 'Using the Replay player'
---

import { Playground, PropsTable } from 'docz';
import Replay from './Replay';
import '../replay-default.css';

# Inserting Replay into your React app

This chapter demonstrates how you can:

* Include the player in your own code.
* Specify what to play.
* Applying some playback settings.
* Control and observe the playback state.

*Note that all examples underneath with actual video include the `initialPlaybackProps={{ isPaused: true }}` property (TODO: link), so that the examples don't play wildly all over the page. Please remove when copying to real app code.*

## Prerequisites

### Installing the Replay npm package

If not already done:

```sh
npm install vimond-replay --save
```

### Importing dependencies

All code examples below need the following import statements:

```javascript
import React from 'react';
import { Replay } from 'vimond-replay';
import 'vimond-replay/lib/index.css';
```

Or substitute the CSS `import` statement with your desired CSS inclusion mechanism, e.g. SASS.

### Video/stream technology support

Out of the box, Replay supports video files that can be played natively in the browser. That typically means MP4 or WebM videos progressively downloaded from a web server location.

By including alternative VideoStreamer (TODO: link) components, Replay can be used for adaptive streams. These cover HLS and DASH streams with live, DVR, embedded text tracks, and DRM if needed. Docs yet to be written.

## Inserting the player and starting it with progressive video

Please remember the import statements discussed above. Include the `source` prop in order to load a video. This prop can be a string with the video URL, or an object containing several pieces of technical details in order to play the video/stream appropriately. Essential is the `streamUrl` property, referring to the video file or adaptive stream URL (if applicable). The object variant is shown in later examples.

This example is live. Press play to test the playback:

<Playground>
  <Replay
    source="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
    initialPlaybackProps={{ isPaused: true }}
  />
</Playground>

Note that Replay doesn't include a poster feature. This is best implemented outside the player component. The player can be inserted without specifying a source, and it will render, but remain inactive.

When the `source` prop is changed, either from unspecified, or from an earlier set source, a new playback will start. Set the same prop to null in order to stop playback.

## Starting playback from a different position than the beginning

The `startPosition` property treats any positive numbers as the number of seconds offset from the beginning.

Note that for this purpose, specifying source as a string doesn't apply anymore. An object with the property `streamUrl` must be passed as the `source` prop, along with the `startPosition` property. The value `123` means that playback will start at 00:02:03.

<Playground>
  <Replay
    source={{ 
      streamUrl: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
      startPosition: 123
    }}
    initialPlaybackProps={{ isPaused: true }}
  />
</Playground>

## Setting volume and mute state for startup

The `initialPlaybackProps` prop can be used to specify a state for volume, pausing, quality selection policies, to be applied on playback startup. These properties can be changed by the playback itself or through the player's user interface. There is no persisting consistency between what being set here, and the actual state during playback, so that's why these are specified as `initialPlaybackProps` only.

The following video will start paused, but when started playing it will happen without audio. When unmuting, the volume level will be set to 20 %.

<Playground>
  <Replay
    source="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
    initialPlaybackProps={{ isPaused: true, isMuted: true, volume: 0.2 }}
  />
</Playground>

## Specifying text tracks along with the video source

*This example does not currently work due to documentation system not serving the referred subtitle files.*

Subtitle files of different languages and kinds can be specified as text tracks along with the stream URL. There are requirements to the metadata fields following the subtitle file URLs.

<Playground>
  <Replay
    source={{ 
      streamUrl: 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
      textTracks: [{
        src: 'en.vtt',
        kind: 'subtitles',
        language: 'en',
        label: 'English',
        contentType: 'text/vtt'
      }, {
        src: 'no.vtt',
        kind: 'subtitles',
        language: 'no',
        label: 'Norwegian',
        contentType: 'text/vtt'
      }]
    }}
    initialPlaybackProps={{ isPaused: true }}
  />
</Playground>

Observe that this reveals the **T** subtitles button and selector in the controls bar. Also note that the subtitles are not selected for display by default.

Text track support relies on the browser's subtitle parsing and display. This means only the WebVTT format is supported, unless taking some of the advanced VideoStreamer components into use.

### Setting (new) text tracks after starting playback of video source

*Also this example does not currently work due to documentation system not serving the referred subtitle files.*

If the text tracks are not available when starting the stream, or when a current set of tracks should be replaced without interrupting playback, specify the new track set in the `textTracks` prop.

<Playground>
  <Replay
    source="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
    initialPlaybackProps={{ isPaused: true }}
    textTracks={[{
      src: 'en.vtt',
      kind: 'subtitles',
      language: 'en',
      label: 'English',
      contentType: 'text/vtt'
    }, {
      src: 'no.vtt',
      kind: 'subtitles',
      language: 'no',
      label: 'Norwegian',
      contentType: 'text/vtt'
    }]}
  />
</Playground>

## Controlling the playback programmatically

Replay provides methods for controlling the playback, like `play()`, `pause()`, `setVolume()`, `mute()`, `setPosition()`, `setSelectedTextTrack()`, and more.

Playback methods are exposed to Replay component consumers through a callback prop `onPlaybackActionsReady`. Specify a method as this property in order to get hold of these methods. Besides the straightforward operations above, there are two special methods provided in the callback.

`setProperties()` is one common method that can be used for all playback operations. This method is passed along with `play()`, `setPosition()`, `capBitrate()` etc. The latter are just sugar methods that call `setProperties()` with different keys and values. `setProperties()` accepts an object with the properties to be set.

See TODO: link for a full reference of playback actions.

See TODO: link for a full reference of playback properties that can be used with setProperties.

Another method returned is `inspect()`. This returns an object with the current playback state, containing properties also exposed through the `onStreamStateChange` callback. 

Observing the playback state properties is discussed thoroughly in the next chapter. It is recommended to keep track of the state reactively, through an `onStreamStateChange` callback instead of using inspect().

The next chapter contains a full code example for controlling and observing the playback outside the Replay player.

```javascript
const playbackActionsReady = actions => {
  this.playVideo = actions.play;
  this.setPlaybackPosition = actions.setPosition;
  this.setPlaybackProperties = actions.setProperties;
}

/// In e.g. click handlers for buttons outside the Replay player.

this.handleRestartClick = () => {
  if (this.setPlaybackPosition) {
    this.setPlaybackPosition(0);
  }
};

this.handleStartClick = () => {
  if (this.playVideo) {
    this.playVideo();
  }
};

// The alternative way, setting properties instead of calling a dedicated method, e.g. unmute().

this.handleUnmuteClick = () => {
  if (this.setPlaybackProperties) {
    this.setPlaybackProperties({ isMuted: false });
  }
}; 

```

## Observing the stream playback state

Playback state consists of playback position, duration, stream mode, pause, seek, and buffering state, available text and audio tracks, bitrate (if adaptive streaming is used).

The `onStreamStateChange` callback prop is invoked when any of these playback state properties changes. The callback is invoked with an object containing the changes as keys/values.

```javascript
this.handleStreamStateChange = stateProperties => {
  if ('position' in stateProperties) {
    console.log('Playback position is', stateProperties.position);
  }
  if ('volume' in stateProperties) {
    console.log('The volume is changed into', stateProperties.volume);
  }
  if (stateProperties.isPaused) {
    console.log('The playback was paused.');
  }
};
```

See TODO: link for a full reference of state properties.


## Full example showing control and observation of the playback

<Playground>
  {() => {
    let playVideo, setPlaybackPosition, setPlaybackProperties;
    
    const playbackActionsReady = actions => {
      playVideo = actions.play;
      setPlaybackPosition = actions.setPosition;
      setPlaybackProperties = actions.setProperties;
    }

    const handleRestartClick = () => {
      if (setPlaybackPosition) {
        setPlaybackPosition(0);
      }
    };
    
    const handleStartClick = () => {
      if (playVideo) {
        playVideo();
      }
    };
    
    // The alternative way, setting properties instead of calling a dedicated method, e.g. unmute().
    const handleUnmuteClick = () => {
      if (setPlaybackProperties) {
        setPlaybackProperties({ isMuted: false });
      }
    };

    // Check the Dev tools console for the log output from this handler:    
    const handleStreamStateChange = stateProperties => {
      if (stateProperties) {
        if ('position' in stateProperties) {
          console.log('Stream observation example: Playback position is ' + stateProperties.position.toFixed(1));
        }
        if ('volume' in stateProperties) {
          console.log('Stream observation example: Playback position is ' + Math.round(stateProperties.volume * 100));
        }
        if (stateProperties.isPaused) {
          console.log('Stream observation example: The playback was paused.');
        }
        if (stateProperties.isPaused === false) {
          console.log('Stream observation example: The playback was resumed.');
        }
        if (stateProperties.playState === 'inactive') {
          console.log('Stream observation example: The playback has ended.');
        }
      }
    };
        
    return ( 
      <div>
        <Replay
          source={{ 
            streamUrl: 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
            startPosition: 13
          }}
          initialPlaybackProps={{ isPaused: true, isMuted: true }}
          onStreamStateChange={handleStreamStateChange}
          onPlaybackActionsReady={playbackActionsReady}
        />
        <p>
          <button onClick={handleStartClick}>Start</button>
          <button onClick={handleRestartClick}>Restart</button>
          <button onClick={handleUnmuteClick}>Unmute</button>
        </p>
      </div>
    );
  }}
</Playground>



